import "tfplan"

has_valid_tags = func(resource) {
  validated = true
  if (resource.applied.tags is not undefined) {
    validated = resource.applied.tags contains "environment"
  }
  return validated
}

main = rule {
  all tfplan.resources as _, types {
    all types as _, type {
      all type as _, resource {
        has_valid_tags(resource)
      }
    }
  }
}